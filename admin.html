<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Quick Electrician</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary-color: #007BFF; --secondary-color: #28a745; --danger-color: #dc3545; --warning-color: #ffc107; --info-color: #17a2b8; --dark-color: #343a40; --light-color: #f8f9fa; }
        body { font-family: 'Poppins', sans-serif; background-color: var(--light-color); color: var(--dark-color); margin: 0; }
        .container { max-width: 1200px; margin: 2rem auto; padding: 0 20px; }
        header { background: var(--dark-color); color: white; padding: 1rem 0; text-align: center; margin-bottom: 2rem; }
        .tabs { display: flex; border-bottom: 2px solid #dee2e6; margin-bottom: 2rem; }
        .tab-link { padding: 1rem 1.5rem; cursor: pointer; border: none; background: none; font-size: 1.1rem; font-weight: 600; color: #495057; }
        .tab-link.active { color: var(--primary-color); border-bottom: 3px solid var(--primary-color); }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .card { background: white; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-bottom: 2rem; overflow: hidden; }
        .card-header { background: var(--primary-color); color: white; padding: 1rem; font-size: 1.2rem; font-weight: 600; }
        .card-body { padding: 1.5rem; }
        .item-list { max-height: 600px; overflow-y: auto; }
        .list-item { display: flex; flex-wrap: wrap; justify-content: space-between; align-items: flex-start; padding: 1rem; border-bottom: 1px solid #eee; }
        .item-details p { margin: 0.2rem 0; }
        .item-details strong { color: #555; }
        .item-actions { margin-top: 10px; flex-shrink: 0; }
        .item-actions button { padding: 0.5rem 1rem; border: none; border-radius: 5px; color: white; cursor: pointer; margin-left: 0.5rem; font-size: 0.9rem; }
        .btn-confirm { background: var(--secondary-color); }
        .btn-complete { background: var(--info-color); }
        .btn-cancel { background: var(--danger-color); }
        .status-tag { padding: 0.25rem 0.6rem; border-radius: 15px; color: white; font-size: 0.8rem; font-weight: 600; }
        .status-Pending { background: var(--warning-color); color: var(--dark-color); }
        .status-Confirmed { background: var(--info-color); }
        .status-Completed { background: var(--secondary-color); }
        .status-Cancelled { background: var(--danger-color); }
        .loader { text-align: center; padding: 2rem; font-size: 1.2rem; }
    </style>
</head>
<body>
    <header><h1>Quick Electrician - Admin Panel</h1></header>

    <div class="container">
        <div class="tabs">
            <button class="tab-link active" onclick="openTab(event, 'Bookings')">Bookings</button>
            <button class="tab-link" onclick="openTab(event, 'Applicants')">Job Applicants</button>
        </div>

        <!-- Bookings Tab -->
        <div id="Bookings" class="tab-content active">
            <div class="card">
                <div class="card-header">Manage Customer Bookings</div>
                <div class="card-body">
                    <div class="item-list" id="booking-list">
                        <div class="loader">Loading bookings...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Applicants Tab -->
        <div id="Applicants" class="tab-content">
            <div class="card">
                <div class="card-header">"Work With Us" Applicants</div>
                <div class="card-body">
                    <div class="item-list" id="applicant-list">
                        <div class="loader">Loading applicants...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- CHANGE THESE VALUES ---
        const SUPABASE_URL = 'https://yswfdprinxrfqexbyzjo.supabase.co'; // यहाँ अपना Supabase URL पेस्ट करें
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inlzd2ZkcHJpbnhyZnFleGJ5empvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk4MzgzMTUsImV4cCI6MjA2NTQxNDMxNX0.LnHAETA_8Z3kMGfqNCFFvwnZJkiE3oWWZNeqg2Csc-4'; // यहाँ अपनी Supabase anon key पेस्ट करें

        const db = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        const bookingList = document.getElementById('booking-list');
        const applicantList = document.getElementById('applicant-list');

        function openTab(evt, tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.style.display = 'none');
            document.querySelectorAll('.tab-link').forEach(link => link.classList.remove('active'));
            document.getElementById(tabName).style.display = 'block';
            evt.currentTarget.classList.add('active');
        }

        // Fetch and display all bookings
        async function fetchBookings() {
            const { data, error } = await db.from('bookings').select('*').order('created_at', { ascending: false });
            if (error) {
                bookingList.innerHTML = '<p>Error loading bookings.</p>';
                return;
            }
            if (data.length === 0) {
                bookingList.innerHTML = '<p>No bookings found.</p>';
                return;
            }

            bookingList.innerHTML = data.map(booking => `
                <div class="list-item">
                    <div class="item-details">
                        <p><strong>Name:</strong> ${booking.name} | <strong>Phone:</strong> <a href="tel:${booking.phone}">${booking.phone}</a></p>
                        <p><strong>Service:</strong> ${booking.service}</p>
                        <p><strong>Address:</strong> ${booking.address}</p>
                        ${booking.message ? `<p><strong>Query:</strong> ${booking.message}</p>` : ''}
                        <p><strong>Status:</strong> <span class="status-tag status-${booking.status}">${booking.status}</span></p>
                    </div>
                    <div class="item-actions">
                        <button class="btn-confirm" data-id="${booking.id}">Confirm</button>
                        <button class="btn-complete" data-id="${booking.id}">Complete</button>
                        <button class="btn-cancel" data-id="${booking.id}">Cancel</button>
                    </div>
                </div>
            `).join('');
        }

        // Fetch and display all job applicants
        async function fetchApplicants() {
            const { data, error } = await db.from('applicants').select('*').order('created_at', { ascending: false });
             if (error) {
                applicantList.innerHTML = '<p>Error loading applicants.</p>';
                return;
            }
            if (data.length === 0) {
                applicantList.innerHTML = '<p>No applicants found.</p>';
                return;
            }

            applicantList.innerHTML = data.map(applicant => `
                 <div class="list-item">
                    <div class="item-details">
                        <p><strong>Name:</strong> ${applicant.name} | <strong>Phone:</strong> <a href="tel:${applicant.phone}">${applicant.phone}</a></p>
                        <p><strong>Experience:</strong> ${applicant.experience} years</p>
                        <p><strong>Specialty:</strong> ${applicant.specialty || 'Not specified'}</p>
                    </div>
                </div>
            `).join('');
        }

        // Handle booking status updates
        bookingList.addEventListener('click', async (e) => {
            if (e.target.matches('button')) {
                const id = e.target.dataset.id;
                let newStatus = '';
                if (e.target.classList.contains('btn-confirm')) newStatus = 'Confirmed';
                else if (e.target.classList.contains('btn-complete')) newStatus = 'Completed';
                else if (e.target.classList.contains('btn-cancel')) newStatus = 'Cancelled';
                
                if (newStatus) {
                    const { error } = await db.from('bookings').update({ status: newStatus }).eq('id', id);
                    if (error) {
                        alert('Failed to update status.');
                    } else {
                        alert(`Booking status updated to ${newStatus}.`);
                        fetchBookings(); // Refresh the list
                    }
                }
            }
        });

        // Initial data load when admin page opens
        document.addEventListener('DOMContentLoaded', () => {
            fetchBookings();
            fetchApplicants();
        });
    </script>
</body>
</html>
