<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Quick Electrician</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root{--primary-color:#007BFF;--secondary-color:#28a745;--danger-color:#dc3545;--warning-color:#ffc107;--info-color:#17a2b8;--dark-color:#343a40;--light-color:#f8f9fa}body{font-family:'Poppins',sans-serif;background-color:var(--light-color);color:var(--dark-color);margin:0}.container{max-width:1200px;margin:2rem auto;padding:0 20px}.tabs{display:flex;border-bottom:2px solid #dee2e6;margin-bottom:2rem}.tab-link{padding:1rem 1.5rem;cursor:pointer;border:none;background:none;font-size:1.1rem;font-weight:600;color:#495057}.tab-link.active{color:var(--primary-color);border-bottom:3px solid var(--primary-color)}.tab-content{display:none}.tab-content.active{display:block}header{background:var(--dark-color);color:white;padding:1rem 0;text-align:center;margin-bottom:2rem}.card{background:white;border-radius:8px;box-shadow:0 2px 5px rgba(0,0,0,.1);margin-bottom:2rem;overflow:hidden}.card-header{background:var(--primary-color);color:white;padding:1rem;font-size:1.2rem;font-weight:600}.card-body{padding:1.5rem}.item-list{max-height:600px;overflow-y:auto}.list-item{display:flex;flex-wrap:wrap;justify-content:space-between;align-items:flex-start;padding:1rem;border-bottom:1px solid #eee}.item-details p{margin:.2rem 0}.item-details strong{color:#555}.item-actions{margin-top:10px;flex-shrink:0}.item-actions button{padding:.5rem 1rem;border:none;border-radius:5px;color:white;cursor:pointer;margin-left:.5rem;font-size:.9rem}.btn-confirm{background:var(--secondary-color)}.btn-complete{background:var(--info-color)}.btn-cancel{background:var(--danger-color)}.status-tag{padding:.25rem .6rem;border-radius:15px;color:white;font-size:.8rem;font-weight:600}.status-Pending{background:var(--warning-color);color:var(--dark-color)}.status-Confirmed{background:var(--info-color)}.status-Completed{background:var(--secondary-color)}.status-Cancelled{background:var(--danger-color)}.loader{text-align:center;padding:2rem;font-size:1.2rem}
    </style>
</head>
<body>
    <header><h1>Quick Electrician - Admin Panel</h1></header>
    <div class="container">
        <div class="tabs">
            <button class="tab-link active" onclick="openTab(event, 'Bookings')">Bookings</button>
            <button class="tab-link" onclick="openTab(event, 'Applicants')">Job Applicants</button>
        </div>
        <div id="Bookings" class="tab-content active">
            <div class="card">
                <div class="card-header">Manage Customer Bookings</div>
                <div class="card-body"><div class="item-list" id="booking-list"><div class="loader">Loading bookings...</div></div></div>
            </div>
        </div>
        <div id="Applicants" class="tab-content">
            <div class="card">
                <div class="card-header">"Work With Us" Applicants</div>
                <div class="card-body"><div class="item-list" id="applicant-list"><div class="loader">Loading applicants...</div></div></div>
            </div>
        </div>
    </div>
    <script>
        const SUPABASE_URL = 'https://yswfdprinxrfqexbyzjo.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inlzd2ZkcHJpbnhyZnFleGJ5empvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk4MzgzMTUsImV4cCI6MjA2NTQxNDMxNX0.LnHAETA_8Z3kMGfqNCFFvwnZJkiE3oWWZNeqg2Csc-4';
        const db = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        const bookingList=document.getElementById('booking-list'),applicantList=document.getElementById('applicant-list');function openTab(e,t){document.querySelectorAll('.tab-content').forEach(e=>e.style.display='none'),document.querySelectorAll('.tab-link').forEach(e=>e.classList.remove('active')),document.getElementById(t).style.display='block',e.currentTarget.classList.add('active')}async function fetchBookings(){const{data:e,error:t}=await db.from('bookings').select(`*, electricians ( name )`).order('created_at',{ascending:!1});t?bookingList.innerHTML='<p>Error loading bookings.</p>':0===e.length?bookingList.innerHTML='<p>No bookings found.</p>':bookingList.innerHTML=e.map(e=>`\n <div class="list-item">\n <div class="item-details">\n <p><strong>Name:</strong> ${e.name} | <strong>Phone:</strong> <a href="tel:${e.phone}">${e.phone}</a></p>\n <p><strong>Service:</strong> ${e.service}</p>\n <p><strong>Address:</strong> ${e.address}</p>\n ${e.message?`<p><strong>Query:</strong> ${e.message}</p>`:''}\n <p><strong>Assigned to:</strong> ${e.electricians?e.electricians.name:'Not Assigned'}</p>\n <p><strong>Status:</strong> <span class="status-tag status-${e.status}">${e.status}</span></p>\n </div>\n <div class="item-actions">\n <button class="btn-confirm" data-id="${e.id}">Mark Confirmed</button>\n <button class="btn-complete" data-id="${e.id}">Mark Complete</button>\n <button class="btn-cancel" data-id="${e.id}">Cancel</button>\n </div>\n </div>`).join('')}async function fetchApplicants(){const{data:e,error:t}=await db.from('applicants').select('*').order('created_at',{ascending:!1});t?applicantList.innerHTML='<p>Error loading applicants.</p>':0===e.length?applicantList.innerHTML='<p>No applicants found.</p>':applicantList.innerHTML=e.map(e=>`\n <div class="list-item">\n <div class="item-details">\n <p><strong>Name:</strong> ${e.name} | <strong>Phone:</strong> <a href="tel:${e.phone}">${e.phone}</a></p>\n <p><strong>Experience:</strong> ${e.experience} years</p>\n <p><strong>Specialty:</strong> ${e.specialty||'Not specified'}</p>\n </div>\n </div>`).join('')}bookingList.addEventListener('click',async e=>{if(e.target.matches('button')){const t=e.target.dataset.id;let a='';e.target.classList.contains('btn-confirm')?a='Confirmed':e.target.classList.contains('btn-complete')?a='Completed':e.target.classList.contains('btn-cancel')&&(a='Cancelled'),a&&db.from('bookings').update({status:a}).eq('id',t).then(({error:e})=>{e?alert('Failed to update status.'):(alert(`Booking status updated to ${a}.`),fetchBookings())})}}),document.addEventListener('DOMContentLoaded',()=>{fetchBookings(),fetchApplicants()});
    </script>
</body>
</html>
